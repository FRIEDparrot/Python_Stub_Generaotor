# Python Stub Generator  
[English](#overview) | [[简体中文]](#中文概述)  

<a id="overview"></a>

## Overview  
A Python script to generate `.pyi` stub files for Python packages/modules. Almost all code (including this README) was generated by AI (Claude 4.0 and GPT).  

**For C++-based Python libraries** (like PyBind11 or petsc4py), this tool solves critical IDE support issues:  
- ❌ Static completion fails in PyCharm  
- ⚠️ Dynamic completion may crash due to memory access violations  
- 🔍 Missing type hints for C++ templates/overloads  

### Key Features
- **Recursive stub generation**: Processes modules and submodules
- **Basic type handling**:
    - Extracts available type hints via `__annotations__`
    - Falls back to `Any` for unknown types 
- **Class support**:
    - Handles inheritance (`__bases__`)
    - Skips most magic methods (except `__init__`, `__call__`, etc.)
- **Directory structure**: Creates `__init__.pyi` files in package hierarchy

### Installation & Usage  
```bash
python pyi_generator.py <package_name> [output_dir] [--remove_if_exists]
```

| Argument             | Description                      |
| -------------------- | -------------------------------- |
| `package_name`       | Target package (e.g. `petsc4py`) |
| `output_dir`         | Optional (default: `./stubs`)    |
| `--remove_if_exists` | Clean existing stubs             |

### Workflow  
1. Generate stubs:  
   ```bash
   python pyi_generator.py petsc4py
   ```
2. In PyCharm:  
   `Right-click stubs folder → Mark Directory as → Sources Root`  

3. You may restart Pycharm to make the completion into effective  

<img src="img\Screenshot 2025-06-22 235206.png" alt="IDE Configuration" style="zoom:36%; center" />

 

* Before/After stub generation in PyCharm 

<img src="img\effect.png" alt="effect" style="zoom:33%;" />

> 💡 **Recommendation**:  For complex C++ interfaces, the generated stubs may not be completely comprehensive. Manual review of the stub files is advised.



---

<a id="中文概述"></a>

## 中文概述
Python 模块类型存根生成工具（基于AI生成代码） 

针对 **C++扩展库** (如 PyBind11/petsc4py):  
- ❌ PyCharm 静态补全完全失效  
- ⚠️ 动态补全可能引发内存访问崩溃  
- 🔍 缺失模板/重载函数的类型提示  

### 核心功能
- **递归生成**: 处理模块及子模块
- **基础类型处理**:
    - 从`__annotations__`提取已知类型
    - 未知类型默认为`Any`
- **类支持**:
    - 处理继承关系
    - 跳过大部分魔术方法
- **目录结构**: 生成包结构的`__init__.pyi`文件 

### 使用流程  
1. 生成存根:  
   ```bash
   python pyi_generator.py petsc4py
   ```
2. PyCharm配置:  
   `右键存根目录 → Mark Directory as → Sources Root`  
3. 可能需要重启 Pycharm 使之生效 

<img src="img\Screenshot 2025-06-22 235206.png" alt="IDE Configuration" style="zoom:36%; center" />

添加存根前后 Pycharm 代码补全效果对比

<center><img src="img\effect.png" alt="effect" style="zoom:33%;" /></center>

> 💡 **建议**: 对复杂C++接口，往往生成的不是非常全面，可人工检查生成的存根文件
